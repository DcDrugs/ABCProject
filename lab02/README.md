# Разработка функционального симулятора

В данной работе вам предстоит разработать функциональный симулятор архитектуры `RISC-V`. Архитектура создана в 2010 в Калифорнийском университете Беркли, распространяется по открытой лицензии и любой может использовать ее для реализации своих вычислительных устройств. Архитектура разрабатывалась по принципу RISC, является модульной. Мотивация разрабоки архитектуры приведена ее авторами в [статье](https://www2.eecs.berkeley.edu/Pubs/TechRpts/2014/EECS-2014-146.pdf), [перевод](https://habr.com/en/post/234047/). Актуальная спецификация находится в открытом [доступе](https://riscv.org/specifications/isa-spec-pdf/). В данной работе предстоит реализовать выполнение набора целочисленных команд.

# Структура проекта

В качестве задания вам предлагается проект симулятора, который необходимо закончить. Структура следующая:
* `programms` — директория с тестовыми программами, которые запускаются на симуляторе.
  * `assembly` — директория с исходниками коротких ассемблерных тестов.
  * `build/assembly` — директория c собранными объектными файлами.
   * `bin` — директория с выполняемыми elf-файлами.
   * `dump` — директория с дампами elf-файлов.
* `src` — директория с исходными файлами симулятора.
  * `main.cpp` — точка входа в программу.
  * `BaseTypes.h` — основные типы программы.
  * `Instruction.{h, cpp}` — описание декодированной инструкции.
  * `Memory.h` — модуль подсистемы памяти.
  * `Cpu.h` — модуль ЦПУ.
  * `Decoder.h` — модуль декодирования инструкции.
  * `RegisterFile.h` — модуль регистров общего назначения.
  * `CsrFile.h` — модуль служебных регистров.
  * `Executor.h` — модуль выполнения инструкции.
* `CMakeLists.txt` — cmake-файл для сборки проекта.
* `test.sh` — скрипт для запуска тестов.
* `units` — директория для юнит-тестов

В `main.cpp` вызывается `Cpu::ProcessInstruction()`. Эта функция выполняет один цикл тракта данных виртуальной машины, исполняющей `RISC-V` код. В рамках этого цикла происходит: получение слова инструкции типа `Word` из модуля памяти `Memory` по указателю инструкции `_ip`, декодирование инструкции в структуру типа `Instruction`,   чтение требуемых инструкцией регистров из регистровых файлов `RegisterFile` и `CsrFile`, исполнение инструкции в модуле `Executor`, обращение в память, запись результата в регистровые файлы `RegisterFile` и `CsrFile`. Завершается цикл обновлением регистров в `CsrFile` и вычислением нового `_ip` для следующего цикла тракта данных.

Собрать проект и запустить тесты можно из терминала следующими командами:
```
cd /path/to/project/directory
mkdir build
cd build
cmake ..
make -j8
cd ..
build/unittest/Doctest_tests_run # запустить юнит-тесты
./test.sh build/src/risсv_sim # запустить симулятор
```
